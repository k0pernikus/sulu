define(["sulumedia/collection/collections"],function(a){"use strict";var b={instanceName:null,url:null,preselected:[1],translations:{noMediaSelected:"media-selection.nomedia-selected",addImages:"media-selection.add-images",choose:"media-selection.choose",collections:"media-selection.collections"}},c="sulu.media-selection.",d=function(){return e.call(this,"input-retrieved")},e=function(a){return c+(this.options.instanceName?this.options.instanceName+".":"")+a},f={skeleton:function(a){return['<div class="media-selection-container form-element">','   <div class="media-selection-header">','       <a href="#" class="fa-plus-circle add" id="',a.ids.addButton,'"></a>','       <div class="position-outer">','           <select class="position" id="',a.ids.position,'">','               <option value="0">left</option>','               <option value="1">right</option>',"           </select>","       </div>",'       <a href="#" class="fa-cog config" id="',a.ids.configButton,'"></a>',"   </div>",'   <div class="media-selection" id="',a.ids.content,'"></div>',"</div>"].join("")},noContent:function(a){return['<div class="no-content">','   <span class="fa-image icon"></span>','   <div class="text">',a,"</div>","</div>"].join("")},addTab:function(a,b){return['<div id="',a.ids.chooseTab,'">','   <div class="head-container"><h1>',b,"</h1></div>",'   <div id="',a.ids.gridGroup,'"/>',"</div>"].join("")}},g=function(a){return"#"+this.options.ids[a]},h=function(){this.collections=new a,this.options.ids={addButton:"media-selection-"+this.options.instanceName+"-add",configButton:"media-selection-"+this.options.instanceName+"-config",position:"media-selection-"+this.options.instanceName+"-position",content:"media-selection-"+this.options.instanceName+"-content",chooseTab:"media-selection-"+this.options.instanceName+"-choose-tab",gridGroup:"media-selection-"+this.options.instanceName+"-grid-group"},this.sandbox.dom.html(this.$el,f.skeleton(this.options)),this.$content=this.sandbox.dom.find(g.call(this,"content"),this.$el),this.$addButton=this.sandbox.dom.find(g.call(this,"addButton"),this.$el),this.$configButton=this.sandbox.dom.find(g.call(this,"configButton"),this.$el),i.call(this),k.call(this),l.call(this),j.call(this)},i=function(){var a=this.sandbox.translate(this.options.translations.noMediaSelected);this.sandbox.dom.html(this.$content,f.noContent(a))},j=function(){},k=function(){this.sandbox.on("husky.tabs.overlaymedia-selection."+this.options.instanceName+".add.initialized",function(){this.collections.fetch({success:function(a){this.sandbox.start([{name:"grid-group@suluadmin",options:{data:a.toJSON(),el:this.sandbox.dom.find(g.call(this,"gridGroup")),instanceName:"collections",gridUrl:"/admin/api/media?collection=",preselected:this.options.preselected,dataGridOptions:{view:"table",viewOptions:{table:{excludeFields:["id"]}},pagination:!1,showHead:!1,matchings:[{id:"id"},{id:"thumbnails",translation:"thumbnails",type:"thumbnails"},{id:"title",translation:"title"},{id:"description",translation:"description"}]}}}])}.bind(this)})}.bind(this)),this.sandbox.on(d.call(this),function(){this.sandbox.logger.log(this.ids)}.bind(this))},l=function(){var a=f.addTab(this.options,this.sandbox.translate(this.options.translations.collections)),b=this.sandbox.dom.createElement("<div/>");this.sandbox.dom.append(this.$el,b),this.sandbox.start([{name:"overlay@husky",options:{triggerEl:this.$addButton,cssClass:"media-selection-overlay",el:b,container:this.$el,instanceName:"media-selection."+this.options.instanceName+".add",skin:"wide",slides:[{title:this.sandbox.translate(this.options.translations.addImages),okCallback:m.bind(this),cssClass:"media-selection-overlay-add",tabs:[{title:this.sandbox.translate(this.options.translations.choose),data:a}]}]}}])},m=function(){var a=this.sandbox.data.deferred();this.sandbox.emit("sulu.grid-group.collections.get-selected-ids",function(b){this.ids=b,a.resolve()}.bind(this)),a.then(function(){this.sandbox.emit(d.call(this))}.bind(this))};return{historyClosed:!0,initialize:function(){this.options=this.sandbox.util.extend({},b,this.options),h.call(this)}}});