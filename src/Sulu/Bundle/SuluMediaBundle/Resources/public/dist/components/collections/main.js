define(function(){"use strict";var a={allCollectionsUrl:"/admin/api/collections?depth=0",singleCollectionUrl:"/admin/api/collections",singleMediaUrl:"/admin/api/media"},b="sulu.media.collections.",c=function(){return g.call(this,"list")},d=function(){return g.call(this,"delete-media")},e=function(){return g.call(this,"media-deleted")},f=function(){return g.call(this,"collection-changed")},g=function(a){return b+a};return{initialize:function(){if(this.bindCustomEvents(),"list"===this.options.display)this.renderList();else{if("files"!==this.options.display)throw"display type wrong";this.renderFiles()}},bindCustomEvents:function(){this.sandbox.on(c.call(this),function(a){this.sandbox.emit("sulu.router.navigate","media/collections",a?!1:!0,!0)},this),this.sandbox.on(d.call(this),this.deleteMedia.bind(this)),this.sandbox.on("sulu.collection-list.collections.title-changed",function(a,b){this.saveCollection(a,{title:b})}.bind(this)),this.sandbox.on("sulu.collection-list.collections.collection-added",function(a){this.saveNewCollection({title:a})}.bind(this)),this.sandbox.on("sulu.media.collections.files",function(a,b){b=b?b:"files",this.sandbox.emit("sulu.router.navigate","media/collections/edit:"+a+"/"+b,!0,!0)}.bind(this))},saveCollection:function(b,c){this.sandbox.util.save(a.singleCollectionUrl+"/"+b,"PUT",c).done(function(a){this.sandbox.emit(f.call(this),a)}.bind(this))},saveNewCollection:function(b){this.sandbox.util.save(a.singleCollectionUrl,"POST",b).done(function(a){this.sandbox.emit(f.call(this),a)}.bind(this))},deleteMedia:function(b,c){this.sandbox.sulu.showDeleteDialog(function(d){d===!0&&this.sandbox.util.foreach(b,function(b){this.sandbox.util.ajax({url:a.singleMediaUrl+"/"+b,type:"DELETE",success:function(){"function"==typeof c?c(b):this.sandbox.emit(e.call(this),b)}.bind(this)})}.bind(this))}.bind(this))},renderList:function(){var b=this.sandbox.dom.createElement('<div id="collections-list-container"/>');this.html(b),this.sandbox.util.load(a.allCollectionsUrl).then(function(a){this.sandbox.start([{name:"collections/components/list@sulumedia",options:{el:b,data:a}}])}.bind(this))},renderFiles:function(){var b=this.sandbox.dom.createElement('<div id="collection-files-container"/>');this.html(b),this.sandbox.util.load(a.singleCollectionUrl+"/"+this.options.id).then(function(a){this.sandbox.start([{name:"collections/components/files@sulumedia",options:{el:b,activeTab:this.options.content,data:a}}])}.bind(this))}}});