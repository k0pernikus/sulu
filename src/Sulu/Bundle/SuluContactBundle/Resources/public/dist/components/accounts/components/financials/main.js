define([],function(){"use strict";var a={headline:"contact.accounts.title"},b={addBankAccountButtonId:"#add-bank-account"},c=function(){this.sandbox.form.addToCollection(this.form,"bankAccounts",{})};return{view:!0,templates:["/admin/contact/template/account/financials"],initialize:function(){this.options=this.sandbox.util.extend(!0,{},a,this.options),this.saved=!0,this.form="#financials-form",this.setHeaderBar(!0),this.render(),this.listenForChange()},render:function(){var a=this.options.data;this.html(this.renderTemplate(this.templates[0])),this.initForm(a),this.bindDomEvents(),this.bindCustomEvents()},initForm:function(a){var b=this.sandbox.form.create(this.form);this.addCollectionFilters(a),b.initialized.then(function(){this.setFormData(a)}.bind(this))},addCollectionFilters:function(){this.sandbox.form.addCollectionFilter(this.form,"bankAccounts",function(a){return""===a.id&&delete a.id,""!==a.bankName&&""!==a.bic&&""!==a.iban})},setFormData:function(a){a&&!a.bankAccounts.length&&delete a.bankAccounts,this.sandbox.form.setData(this.form,a).then(function(){this.sandbox.start(this.form)}.bind(this))},bindDomEvents:function(){this.sandbox.dom.keypress(this.form,function(a){13===a.which&&(a.preventDefault(),this.submit())}.bind(this)),this.sandbox.dom.on(b.addBankAccountButtonId,"click",c.bind(this))},bindCustomEvents:function(){this.sandbox.on("sulu.header.toolbar.delete",function(){this.sandbox.emit("sulu.contacts.account.delete",this.options.data.id)},this),this.sandbox.on("sulu.contacts.accounts.financials.saved",function(a){this.options.data=a,this.setFormData(a),this.setHeaderBar(!0)},this),this.sandbox.on("sulu.header.toolbar.save",function(){this.submit()},this),this.sandbox.on("sulu.header.back",function(){this.sandbox.emit("sulu.contacts.accounts.list")},this)},submit:function(){if(this.sandbox.form.validate(this.form)){var a=this.sandbox.form.getData(this.form);this.sandbox.emit("sulu.contacts.accounts.financials.save",a)}},setHeaderBar:function(a){if(a!==this.saved){var b=this.options.data&&this.options.data.id?"edit":"add";this.sandbox.emit("sulu.header.toolbar.state.change",b,a,!0)}this.saved=a},listenForChange:function(){this.sandbox.dom.on(this.form,"change",function(){this.setHeaderBar(!1)}.bind(this),"select, input, textarea"),this.sandbox.dom.on(this.form,"keyup",function(){this.setHeaderBar(!1)}.bind(this),"input, textarea"),this.sandbox.on("sulu.contact-form.changed",function(){this.setHeaderBar(!1)}.bind(this))}}});