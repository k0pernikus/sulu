define(["text!sulucontact/components/activities/activity.form.html"],function(a){"use strict";var b={overlayId:"activitiesOverlay",activityFormSelector:"#acitivity-form",activitiesURL:"/admin/api/activities/"},c=function(){this.sandbox.on("sulu.contacts.contact.activities.defaults",function(a){this.defaults=a},this),this.sandbox.on("sulu.contacts.contact.activity.loaded",function(a){f.call(this,a)},this),this.sandbox.on("husky.datagrid.item.click",function(a){this.sandbox.emit("sulu.contacts.contact.activity.load",a)},this),this.sandbox.on("sulu.list-toolbar.delete",function(){},this),this.sandbox.on("sulu.header.back",function(){this.sandbox.emit("sulu.contacts.contacts.list")},this),this.sandbox.on("sulu.contacts.accounts.contact.saved",function(a){this.sandbox.emit("husky.datagrid.record.add",a)},this),this.sandbox.on("sulu.contacts.accounts.contacts.removed",function(a){this.sandbox.emit("husky.datagrid.record.remove",a)},this),this.sandbox.on("husky.overlay.activity-add-edit.opened",function(){this.sandbox.start(b.activityFormSelector);var a=this.sandbox.form.create(b.activityFormSelector);a.initialized.then(function(){this.sandbox.form.setData(b.activityFormSelector,this.overlayData)}.bind(this))}.bind(this))},d=function(){var a=this.sandbox.translate("contact.contacts.title"),b=[{title:"navigation.contacts"},{title:"contact.contacts.title",event:"sulu.contacts.contacts.list"}];this.options.contact&&this.options.contact.id&&(a=this.options.contact.fullName,b.push({title:"#"+this.options.contact.id})),this.sandbox.emit("sulu.header.set-title",a),this.sandbox.emit("sulu.header.set-breadcrumb",b)},e=function(a){a?this.sandbox.emit("sulu.contacts.contact.activity.load",a):f.call(this,{})},f=function(c){var d,e,f,i;this.sandbox.dom.remove("#"+b.overlayId),f=this.sandbox.dom.createElement('<div id="'+b.overlayId+'"></div>'),this.sandbox.dom.append(this.$el,f),this.overlayData=c,d=this.sandbox.translate(c&&c.id?"contact.contacts.activities.edit":"contact.contacts.activities.add"),i={activityTypes:window.activityTypes,activityPriorities:window.activityPriorities,activityStatuses:window.activityStatuses,translate:this.sandbox.translate},e=this.sandbox.util.template(a,i),this.sandbox.start([{name:"overlay@husky",options:{el:f,title:d,openOnStart:!0,removeOnClose:!0,instanceName:"activity-add-edit",data:e,skin:"wide",okCallback:h.bind(this),closeCallback:g.bind(this)}}])},g=function(){this.sandbox.stop(b.activityFormSelector)},h=function(){var a=this.sandbox.form.getData(b.activityFormSelector);this.sandbox.emit("sulu.contacts.contact.activity.save",a),g()},i=function(){return[{id:"add",icon:"plus-circle","class":"highlight-white",title:"add",position:10,callback:e.bind(this)},{id:"settings",icon:"gear",items:[{title:this.sandbox.translate("list-toolbar.column-options")},{title:this.sandbox.translate("contact.activities.remove")}]}]};return{view:!0,templates:["/admin/contact/template/contact/activities"],initialize:function(){this.contact=this.options.contact,this.render(),c.call(this)},render:function(){this.sandbox.dom.html(this.$el,this.renderTemplate("/admin/contact/template/contact/activities")),d.call(this),this.sandbox.sulu.initListToolbarAndList.call(this,"activitiesContactsFields","/admin/api/contacts/fields",{el:this.$find("#list-toolbar-container"),instanceName:"contacts",inHeader:!0,template:i},{el:this.sandbox.dom.find("#activities-list",this.$el),url:"/admin/api/accounts/1/contacts?flat=true",searchInstanceName:"contacts",viewOptions:{table:{selectItem:{type:"checkbox"},removeRow:!1}}})}}});