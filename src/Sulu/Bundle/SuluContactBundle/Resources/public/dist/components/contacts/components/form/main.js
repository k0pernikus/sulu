define([],function(){"use strict";return function(){var a,b,c,d,e="#contact-form";return{view:!0,templates:["/admin/contact/template/contact/form"],initialize:function(){this.saved=!0,d=1,this.formId="#contact-form",this.render(),this.setHeaderBar(!0),this.listenForChange()},render:function(){this.sandbox.once("sulu.contacts.set-defaults",this.setDefaults.bind(this)),this.$el.html(this.renderTemplate("/admin/contact/template/contact/form")),a=this.$find("#emails .emails-item:first"),b=this.$find("#phones .phones-item:first"),c=this.$find("#addresses .addresses-item:first"),this.sandbox.on("husky.dropdown.type.item.click",this.typeClick.bind(this));var d=this.initData();this.companyInstanceName="companyContact"+d.id,this.sandbox.start([{name:"auto-complete@husky",options:{el:"#company",remoteUrl:"/admin/api/accounts?searchFields=id,name&flat=true",getParameter:"search",value:d.account,instanceName:this.companyInstanceName,valueName:"name",noNewValues:!0}}]),this.createForm(d),this.bindDomEvents(),this.bindCustomEvents()},setDefaults:function(a){this.defaultTypes=a},createForm:function(a){var b=this.sandbox.form.create(e);b.initialized.then(function(){this.sandbox.form.setData(e,a).then(function(){this.sandbox.start(e),this.sandbox.form.addConstraint(this.form,emailSelector+" input.email-value","required",{required:!0}),this.sandbox.dom.addClass(emailSelector+" label span:first","required")}.bind(this))}.bind(this)),this.sandbox.form.addCollectionFilter(this.form,"emails",function(a){return""===a.id&&delete a.id,""!==a.email}),this.sandbox.form.addCollectionFilter(this.form,"phones",function(a){return""===a.id&&delete a.id,""!==a.phone}),this.sandbox.form.addCollectionFilter(this.form,"urls",function(a){return""===a.id&&delete a.id,""!==a.url}),this.sandbox.form.addCollectionFilter(this.form,"notes",function(a){return""===a.id&&delete a.id,""!==a.value})},bindDomEvents:function(){},bindCustomEvents:function(){this.sandbox.on("sulu.edit-toolbar.delete",function(){this.sandbox.emit("sulu.contacts.contact.delete",this.options.data.id)},this),this.sandbox.on("sulu.contacts.contacts.saved",function(a){this.options.data=a,this.sandbox.form.setData(e,a),this.setHeaderBar(!0)},this),this.sandbox.on("sulu.edit-toolbar.save",function(){this.submit()},this),this.sandbox.on("sulu.edit-toolbar.back",function(){this.sandbox.emit("sulu.contacts.contacts.list")},this)},initData:function(){var a=this.options.data;return this.fillFields(a.urls,1,{id:null,url:"",urlType:this.defaultTypes.urlType}),this.fillFields(a.emails,1,{id:null,email:"",emailType:this.defaultTypes.emailType}),this.fillFields(a.phones,1,{id:null,phone:"",phoneType:this.defaultTypes.phoneType}),a},typeClick:function(a,b){this.sandbox.logger.log("email click",a),b.find("*.type-value").data("element").setValue(a)},fillFields:function(a,b,c){for(;a.length<b;)a.push(c)},submit:function(){if(this.sandbox.logger.log("save Model"),this.sandbox.form.validate(e)){var a=this.sandbox.form.getData(e);""===a.id&&delete a.id,a.account={id:this.sandbox.dom.data("#"+this.companyInstanceName,"id")},this.sandbox.logger.log("log data",a),this.sandbox.emit("sulu.contacts.contacts.save",a)}},checkRowMargin:function(a){var b=this.sandbox.dom.parent(a);this.sandbox.dom.children(b).length>2&&this.sandbox.dom.addClass(a,"m-top-20")},setHeaderBar:function(a){if(a!==this.saved){var b=this.options.data&&this.options.data.id?"edit":"add";this.sandbox.emit("sulu.edit-toolbar.content.state.change",b,a,!0)}this.saved=a},listenForChange:function(){this.sandbox.dom.on("#contact-form","change",function(){this.setHeaderBar(!1)}.bind(this),"select, input, textarea"),this.sandbox.dom.on("#contact-form","keyup",function(){this.setHeaderBar(!1)}.bind(this),"input")}}}()});