define(["mvc/relationalstore","app-config"],function(a,b){"use strict";var c=function(){this.sandbox.on("husky.datagrid.item.click",function(a){this.sandbox.emit("sulu.contacts.accounts.load",a)},this),this.sandbox.on("sulu.list-toolbar.delete",function(){this.sandbox.emit("husky.datagrid.items.get-selected",function(a){this.sandbox.emit("sulu.contacts.accounts.delete",a)}.bind(this))},this),this.sandbox.on("sulu.list-toolbar.add",function(){this.sandbox.emit("sulu.contacts.accounts.new")},this)},d="",e=function(){var a,c,e,g,h={callback:f.bind(this),preselect:!1,preselector:"position",data:null},i=b.getSection("sulu-contact").accountTypes;for(a=[{id:"all",title:this.sandbox.translate("public.all")}],c=0,e=i.length;++c<e;)a.push({id:i[c].id,name:i[c].name,title:this.sandbox.translate(i[c].translation)});if(this.options.accountType){for(c=0,e=i.length;++c<e;)if(i[c].name===this.options.accountType){g=i[c];break}d+="&searchFields=type&search="+g.id}return h.data={items:a},h.preselect=g?g.id+1:!1,h},f=function(a){var b="",c="";"all"!==a.id&&(c="type",b=a.id),this.sandbox.emit("husky.datagrid.data.search",b,c),this.sandbox.emit("sulu.contacts.accounts.list",a.name,!0)},g=function(a){this.sandbox.emit("sulu.contacts.accounts.new",a)};return{view:!0,header:function(){return{title:"contact.accounts.title",tabs:{fullControl:!0,options:e.call(this)},toolbar:{template:[]}}},templates:["/admin/contact/template/account/list"],initialize:function(){this.render(),c.call(this)},render:function(){a.reset(),this.sandbox.dom.html(this.$el,this.renderTemplate("/admin/contact/template/account/list")),this.sandbox.sulu.initListToolbarAndList.call(this,"accountsFields","/admin/api/accounts/fields",{el:"#list-toolbar-container",instanceName:"accounts",parentTemplate:"default",template:function(){return[{id:"add",icon:"circle-plus","class":"highlight",title:this.sandbox.translate("sulu.list-toolbar.add"),items:[{id:"add-basic",title:this.sandbox.translate("contact.account.add-basic"),callback:g.bind(this,"basic")},{id:"add-lead",title:this.sandbox.translate("contact.account.add-lead"),callback:g.bind(this,"lead")},{id:"add-customer",title:this.sandbox.translate("contact.account.add-customer"),callback:g.bind(this,"customer")},{id:"add-supplier",title:this.sandbox.translate("contact.account.add-supplier"),callback:g.bind(this,"supplier")}],callback:function(){this.sandbox.emit("sulu.list-toolbar.add")}.bind(this)}]}},{el:this.sandbox.dom.find("#companies-list",this.$el),url:"/admin/api/accounts?flat=true"+d,sortable:!0,selectItem:{type:"checkbox"}})}}});