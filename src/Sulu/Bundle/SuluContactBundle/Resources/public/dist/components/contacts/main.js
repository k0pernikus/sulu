define(["sulucontact/model/contact"],function(a){"use strict";return{initialize:function(){if(this.bindCustomEvents(),"list"===this.options.display)this.renderList();else{if("form"!==this.options.display)throw"display type wrong";this.renderForm()}},bindCustomEvents:function(){this.sandbox.on("sulu.contacts.contact.delete",function(){this.del()},this),this.sandbox.on("sulu.contacts.contacts.save",function(a){this.save(a)},this),this.sandbox.on("sulu.contacts.contacts.load",function(a){this.load(a)},this),this.sandbox.on("sulu.contacts.contacts.new",function(){this.add()},this),this.sandbox.on("sulu.contacts.contacts.delete",function(a){this.delContacts(a)},this),this.sandbox.on("sulu.contacts.contacts.list",function(){this.sandbox.emit("sulu.router.navigate","contacts/contacts")},this)},del:function(){this.confirmDeleteDialog(function(a){a&&(this.sandbox.emit("sulu.edit-toolbar.content.item.loading","options-button"),this.contact.destroy({success:function(){this.sandbox.emit("sulu.router.navigate","contacts/contacts")}.bind(this)}))}.bind(this))},save:function(a){this.sandbox.emit("sulu.edit-toolbar.content.item.loading","save-button"),this.contact.set(a),this.contact.save(null,{success:function(b){var c=b.toJSON();a.id?this.sandbox.emit("sulu.contacts.contacts.saved",c):this.sandbox.emit("sulu.router.navigate","contacts/contacts/edit:"+c.id+"/details")}.bind(this),error:function(){this.sandbox.logger.log("error while saving profile")}.bind(this)})},load:function(a){this.sandbox.emit("sulu.router.navigate","contacts/contacts/edit:"+a+"/details")},add:function(){this.sandbox.emit("sulu.router.navigate","contacts/contacts/add")},delContacts:function(b){return b.length<1?void this.sandbox.emit("sulu.dialog.error.show","No contacts selected for Deletion"):void this.confirmDeleteDialog(function(c){c&&b.forEach(function(b){var c=new a({id:b});c.destroy({success:function(){this.sandbox.emit("husky.datagrid.row.remove",b)}.bind(this)})}.bind(this))}.bind(this))},renderList:function(){var a=this.sandbox.dom.createElement('<div id="contacts-list-container"/>');this.html(a),this.sandbox.start([{name:"contacts/components/list@sulucontact",options:{el:a}}])},renderForm:function(){this.contact=new a;var b=this.sandbox.dom.createElement('<div id="contacts-form-container"/>');this.html(b),this.options.id?(this.contact=new a({id:this.options.id}),this.contact.fetch({success:function(a){this.sandbox.start([{name:"contacts/components/form@sulucontact",options:{el:b,data:a.toJSON()}}])}.bind(this),error:function(){this.sandbox.logger.log("error while fetching contact")}.bind(this)})):this.sandbox.start([{name:"contacts/components/form@sulucontact",options:{el:b,data:this.contact.toJSON()}}])},confirmDeleteDialog:function(a){if(a&&"function"!=typeof a)throw"callback is not a function";this.sandbox.emit("sulu.dialog.confirmation.show",{content:{title:"Be careful!",content:"<p>The operation you are about to do will delete data.<br/>This is not undoable!</p><p>Please think about it and accept or decline.</p>"},footer:{buttonCancelText:"Don't do it",buttonSubmitText:"Do it, I understand"},callback:{submit:function(){this.sandbox.emit("husky.dialog.hide"),a&&a(!0)}.bind(this),cancel:function(){this.sandbox.emit("husky.dialog.hide"),a&&a(!1)}.bind(this)}})}}});