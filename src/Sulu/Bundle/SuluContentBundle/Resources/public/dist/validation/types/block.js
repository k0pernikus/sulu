define(["type/default"],function(a){"use strict";return function(b,c,d){var e={},f={initializeSub:function(){var a,b,c,e=[];for(this.templates={},this.index=0,a=0,b=this.options.config.length;b>a;a++)c=this.options.config[a],this.templates[c.data]=App.dom.find("#"+c.tpl,this.$el).html(),c.id=c.data,e.push(c);this.id=this.$el.attr("id"),this.$addButton=$("#"+this.id+"-add"),this.propertyName=App.dom.data(this.$el,"mapperProperty"),this.initSelectComponent(e),this.bindDomEvents(),this.setValue([]),$(d.$el).trigger("form-collection-init",[this.propertyName])},getChildren:function(){return this.$el.children()},getMinOccurs:function(){return this.options.min},getMaxOccurs:function(){return this.options.max},canAdd:function(){var a=this.getChildren().length;return null===this.getMaxOccurs()||a<this.getMaxOccurs()},canRemove:function(){var a=this.getChildren().length;return a>this.getMinOccurs()},initSelectComponent:function(a){App.start([{name:"select@husky",options:{el:this.$addButton,instanceName:this.id,multipleSelect:!1,valueName:"title",small:!1,data:a,selectCallback:function(a){this.addChild(a,{})}.bind(this)}}])},bindDomEvents:function(){this.$el.on("click",'*[data-mapper-remove="'+this.propertyName+'"]',this.removeClick.bind(this))},removeClick:function(){var a=$(event.target),b=a.closest("."+this.propertyName+"-element");this.canRemove()&&(b.remove(),$(d.$el).trigger("form-remove",[this.propertyName,data]),this.checkFullAndEmpty())},validate:function(){return!0},addChild:function(a,b){if(this.canAdd()){var c=$.extend({},{index:this.index++,translate:App.translate},b),e=_.template(this.templates[a],c,d.options.delimiter),f=$(e);App.dom.append(this.$el,f),d.initFields(f).then(function(){d.mapper.setData(b,f),$(d.$el).trigger("form-add",[this.propertyName,b])}.bind(this)),this.checkFullAndEmpty()}},checkFullAndEmpty:function(){this.$addButton.removeClass("empty"),this.$addButton.removeClass("full"),this.$el.removeClass("empty"),this.$el.removeClass("full"),this.canAdd()?this.canRemove()||(this.$addButton.addClass("empty"),this.$el.addClass("empty")):(this.$addButton.addClass("full"),this.$el.addClass("full"))},internalSetValue:function(a){var b,c,d;for(App.dom.children(this.$el).remove(),c=a.length<this.getMinOccurs()?this.getMinOccurs():a.length,b=0;c>b;b++)d=a[b]||{},this.addChild(d.type||this.options.default,d)},setValue:function(a){this.internalSetValue(a)},getValue:function(){var a=[];return App.dom.children(this.$el).each(function(){a.push(d.mapper.getData($(this)))}),a}};return new a(b,e,c,"block",f,d)}});