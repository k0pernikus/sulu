define([],function(){"use strict";var a={toolbar:{resolutions:[1920,1680,1440,1024,800,600,480],showLeft:!0,showRight:!0},mainContentElementIdentifier:"",mainContentMinWidth:530,marginPreviewCollapsedLeft:30,iframeSource:{url:"",webspace:"",language:"",id:""},transitionDuration:500,minMainContentMarginLeft:10,maxMainContentMarginLeft:50,maxMainContentPaddingLeft:50},b={minWidthToolbar:1200,toolbarLeft:"preview-toolbar-left",toolbarRight:"preview-toolbar-right",toolbarNewWindow:"preview-toolbar-new-window",toolbarResolutions:"preview-toolbar-resolutions"},c="husky.preview.",d=c+"initialized",e=c+"expending",f=c+"collapsing",g=c+"hide";return{initialize:function(){this.options=this.sandbox.util.extend({},a,this.options),this.previewWidth=0,this.url="",this.isExpanded=!1,this.$wrapper=null,this.$iframe=null,this.$toolbar=null,this.$mainContent=this.sandbox.dom.$("#"+this.options.mainContentElementIdentifier)[0],this.mainContentOriginalWidth=this.sandbox.dom.width(this.$mainContent)+100,this.render(),this.bindDomEvents(),this.bindCustomEvents(),this.sandbox.emit(d)},render:function(){this.url=this.getUrl(this.options.iframeSource.url,this.options.iframeSource.webspace,this.options.iframeSource.language,this.options.iframeSource.id),this.renderWrapper(),this.renderIframe(this.previewWidth,this.url),this.renderToolbar()},renderWrapper:function(){var a,b;return this.$mainContent?(a=this.sandbox.dom.outerWidth(this.$mainContent),b=this.sandbox.dom.width(document),this.previewWidth=b-(a+this.options.marginPreviewCollapsedLeft),this.$wrapper=this.sandbox.dom.$('<div class="preview-wrapper" id="preview-wrapper" style=""></div>'),this.sandbox.dom.css(this.$wrapper,"width",this.previewWidth+"px"),void this.sandbox.dom.append(this.$el,this.$wrapper)):void this.sandbox.logger.error("main content element could not be found!")},renderIframe:function(a,b){this.$iframe=this.sandbox.dom.$('<iframe id="preview-iframe" class="preview-iframe" src="'+b+'" width="'+a+'px" height="100%"></iframe>'),this.sandbox.dom.append(this.$wrapper,this.$iframe)},renderToolbar:function(){var a=this.sandbox.translate("content.preview.resolutions");this.$toolbar=this.sandbox.dom.$(['<div id="preview-toolbar" class="preview-toolbar">','<div id="',b.toolbarLeft,'" class="left pointer collapsed"><span class="icon-step-backward"></span></div>','<div id="',b.toolbarRight,'" class="right">','<div id="',b.toolbarNewWindow,'" class="new-window pull-right pointer"><span class="icon-disk-export"></span></div>','<div id="',b.toolbarResolutions,'" class="resolutions pull-right pointer">','<label class="drop-down-trigger">','<span class="dropdown-toggle"></span>','<span class="dropdown-label">',a,"</span>","</label>","</div>","</div>","</div>"].join("")),this.sandbox.dom.css(this.$toolbar,"width",this.previewWidth+30+"px"),this.sandbox.dom.append(this.$el,this.$toolbar),this.$toolbarRight=this.sandbox.dom.find("#"+b.toolbarRight,this.$toolbar),this.$toolbarResolutionsLabel=this.sandbox.dom.find(".dropdown-label",this.$toolbarRight),this.sandbox.dom.width(window)<b.minWidthToolbar&&this.sandbox.dom.addClass(this.$toolbarRight,"hidden"),this.renderResolutionDropdown()},renderResolutionDropdown:function(){var a=this.getResolutions();a.length>0&&this.sandbox.start([{name:"dropdown@husky",options:{el:"#"+b.toolbarResolutions,trigger:".drop-down-trigger",setParentDropDown:!0,instanceName:"resolutionsDropdown",alignment:"left",data:a}}])},bindDomEvents:function(){this.sandbox.dom.on("#"+b.toolbarLeft,"click",function(a){var b=a.currentTarget;this.isExpanded?this.collapsePreview(b):this.expandPreview(b)}.bind(this)),this.sandbox.dom.on("#"+b.toolbarNewWindow,"click",function(){window.open(this.url),this.sandbox.dom.hide(this.$wrapper),this.sandbox.dom.hide(this.$toolbar),this.isExpanded&&(this.sandbox.emit("husky.navigation.show"),this.sandbox.emit("husky.page-functions.show"),this.sandbox.emit("sulu.app.content.dimensions-change",{width:this.mainContentOriginalWidth,left:this.options.maxMainContentMarginLeft,paddingLeft:this.options.maxMainContentPaddingLeft})),this.sandbox.emit(g)}.bind(this))},bindCustomEvents:function(){this.sandbox.on("husky.dropdown.resolutionsDropdown.showing",function(){var a=this.sandbox.dom.find("#"+b.toolbarResolutions,this.$toolbarRight),c=this.sandbox.dom.find(".dropdown-menu",a);this.sandbox.dom.width(c,a.outerWidth()),this.sandbox.dom.width(a,a.outerWidth())}.bind(this)),this.sandbox.on("husky.dropdown.resolutionsDropdown.item.click",function(a){this.sandbox.dom.text(this.$toolbarResolutionsLabel,a.name)}.bind(this)),this.sandbox.on("sulu.app.viewport.dimensions-changed",this.dimensionsChanged.bind(this))},expandPreview:function(a){var c=this.sandbox.dom.find("span",a),d=this.sandbox.dom.width(document)-500;this.sandbox.emit("sulu.content.tabs.deactivate"),this.sandbox.dom.removeClass(a,"collapsed"),this.sandbox.dom.addClass(a,"expanded"),this.sandbox.dom.addClass(c,"icon-step-forward"),this.sandbox.dom.removeClass(c,"icon-step-backward"),this.sandbox.emit(e),this.isExpanded=!0,this.sandbox.dom.width(window)<b.minWidthToolbar&&this.sandbox.dom.removeClass(this.$toolbarRight,"hidden"),this.animateCollapseAndExpand(!0,d)},collapsePreview:function(a){this.sandbox.emit("sulu.content.tabs.activate");var c=this.sandbox.dom.find("span",a);this.sandbox.dom.removeClass(a,"expanded"),this.sandbox.dom.addClass(a,"collapsed"),this.sandbox.dom.removeClass(c,"icon-step-forward"),this.sandbox.dom.addClass(c,"icon-step-backward"),this.sandbox.emit(f),this.isExpanded=!1,this.sandbox.dom.width(window)<b.minWidthToolbar&&this.sandbox.dom.addClass(this.$toolbarRight,"hidden"),this.animateCollapseAndExpand(!1,this.previewWidth)},animateCollapseAndExpand:function(a,b){this.sandbox.dom.animate(this.$wrapper,{width:b+"px"},{duration:this.options.transitionDuration,queue:!1}),this.sandbox.dom.animate(this.$iframe,{width:b+"px"},{duration:this.options.transitionDuration,queue:!1}),this.sandbox.dom.animate(this.$toolbar,{width:b+this.options.marginPreviewCollapsedLeft+"px"},{duration:this.options.transitionDuration,queue:!1}),a?(this.sandbox.emit("husky.navigation.hide"),this.sandbox.emit("husky.page-functions.hide"),this.sandbox.emit("sulu.app.content.dimensions-change",{width:this.options.mainContentMinWidth,left:this.options.minMainContentMarginLeft,paddingLeft:0})):(this.sandbox.emit("husky.navigation.show"),this.sandbox.emit("husky.page-functions.show"),this.sandbox.emit("sulu.app.content.dimensions-change",{width:this.mainContentOriginalWidth,left:this.options.maxMainContentMarginLeft,paddingLeft:this.options.maxMainContentPaddingLeft}))},dimensionsChanged:function(a){var b=this.sandbox.dom.outerWidth(this.$mainContent),c=(b-this.sandbox.dom.width(this.$mainContent))/2,d=a.width-(b+c);return a.width<980||0>=d?void this.sandbox.dom.hide(this.$el):(a.width<this.options.minWidthToolbar?this.sandbox.dom.hide(this.$toolbarRight):(this.sandbox.dom.show(this.$el),this.sandbox.dom.show(this.$toolbarRight)),this.sandbox.dom.width(this.$wrapper,d),void this.sandbox.dom.width(this.$toolbar,d+this.options.marginPreviewCollapsedLeft))},getUrl:function(a,b,c,d){return a&&d&&b&&c?(a="/"===a[a.length-1]?a:a+"/",a+=d+"?",a+="webspace="+b,a+="&language="+c):(this.sandbox.logger.error("not all url params for iframe definded!"),"")},getResolutions:function(){for(var a=[],b=0;b<this.options.toolbar.resolutions.length;)a.push({id:b,name:this.options.toolbar.resolutions[b]+" px",value:this.options.toolbar.resolutions[b]}),++b;return a}}});
