define(["sulucontent/model/content"],function(a){"use strict";return{stateDropdownItems:{publish:function(){return{id:"publish",title:this.sandbox.translate("edit-toolbar.state-publish"),icon:"publish",callback:function(){this.changeState(2)}.bind(this)}},test:function(){return{id:"test",title:this.sandbox.translate("edit-toolbar.state-test"),icon:"test",callback:function(){this.changeState(1)}.bind(this)}}},stateDropdownTemplates:{none:function(){return[]},test:function(){return[this.stateDropdownItems.publish.call(this)]},publish:function(){return[this.stateDropdownItems.test.call(this)]}},initialize:function(){if(this.bindCustomEvents(),"list"===this.options.display)this.renderList();else if("form"===this.options.display)this.renderForm();else{if("column"!==this.options.display)throw"display type wrong";this.renderColumn()}},bindCustomEvents:function(){this.sandbox.on("sulu.content.content.delete",function(a){this.del(a)},this),this.sandbox.on("sulu.content.contents.save",function(a,b,c){this.save(a,b,c)},this),this.sandbox.on("sulu.content.contents.load",function(a){this.load(a)},this),this.sandbox.on("sulu.content.contents.new",function(a){this.add(a)},this),this.sandbox.on("sulu.content.contents.delete",function(a){this.delContents(a)},this),this.sandbox.on("sulu.content.contents.getRL",function(a,b){this.getResourceLocator(a,b)},this),this.sandbox.on("sulu.content.contents.list",function(){this.sandbox.emit("sulu.router.navigate","content/contents/"+this.options.webspace+"/"+this.options.language)},this),this.sandbox.on("sulu.content.contents.getDropdownForState",function(a,b){b(this.getDropdownForState(a))},this),this.sandbox.on("sulu.content.contents.getStateDropdownItem",function(a,b){b(this.getStateDropdownItem(a))},this)},getStateWithId:function(a){var b="";switch(a){case 0:b="none";break;case 1:b="test";break;case 2:b="publish";break;default:this.sandbox.logger.error("No state for id",a)}return b},getDropdownForState:function(a){var b=this.getStateWithId(a);return this.stateDropdownTemplates[b].call(this)},getStateDropdownItem:function(a){a=0===a?1:a;var b=this.getStateWithId(a);return this.stateDropdownItems[b].call(this)},getResourceLocator:function(a,b){var c="/admin/content/resourcelocator.json?"+(this.options.parent?"parent="+this.options.parent+"&":"")+"title="+a+"&webspace="+this.options.webspace;this.sandbox.util.load(c).then(function(a){b(a.resourceLocator)})},del:function(b){this.showConfirmSingleDeleteDialog(function(c){if(c)if(this.sandbox.emit("sulu.edit-toolbar.content.item.loading","options-button"),b!==this.content.get("id")){var d=new a({id:b});d.fullDestroy(this.options.webspace,this.options.language,{processData:!0,success:function(){this.sandbox.emit("sulu.router.navigate","content/contents/"+this.options.webspace+"/"+this.options.language),this.sandbox.emit("sulu.preview.deleted",b)}.bind(this)})}else this.content.fullDestroy(this.options.webspace,this.options.language,{processData:!0,success:function(){this.sandbox.emit("sulu.router.navigate","content/contents/"+this.options.webspace+"/"+this.options.language),this.sandbox.emit("sulu.preview.deleted",b)}.bind(this)})}.bind(this),this.options.id)},showConfirmSingleDeleteDialog:function(a){if(a&&"function"!=typeof a)throw"callback is not a function";var b={templateType:null,title:"Warning!",content:"Do you really want to delete the selected company? All data is going to be lost.",buttonCancelText:"Cancel",buttonSubmitText:"Delete"};this.sandbox.emit("sulu.dialog.confirmation.show",{content:{title:b.title,content:b.content},footer:{buttonCancelText:b.buttonCancelText,buttonSubmitText:b.buttonSubmitText},callback:{submit:function(){this.sandbox.emit("husky.dialog.hide"),a&&a(!0)}.bind(this),cancel:function(){this.sandbox.emit("husky.dialog.hide"),a&&a(!1)}.bind(this)}},b.templateType)},changeState:function(a){this.sandbox.emit("sulu.content.contents.state.change"),this.content.stateSave(this.options.webspace,this.options.language,a,null,{success:function(){this.sandbox.emit("sulu.content.contents.state.changed",a),this.sandbox.emit("sulu.labels.success.show","labels.state-changed.success-desc","labels.state-changed.success","sulu.content.contents.state.label")}.bind(this),error:function(){this.sandbox.emit("sulu.content.contents.state.changeFailed"),this.sandbox.emit("sulu.labels.error.show","labels.state-changed.error-desc","labels.state-changed.error","sulu.content.contents.state.label"),this.sandbox.logger.log("error while saving profile")}.bind(this)})},save:function(a,b,c){this.content.set(a),this.content.fullSave(b,this.options.webspace,this.options.language,this.options.parent,null,c,null,{success:function(a){var b=a.toJSON();this.options.id?this.sandbox.emit("sulu.content.contents.saved",b.id):this.sandbox.emit("sulu.router.navigate","content/contents/"+this.options.webspace+"/"+this.options.language+"/edit:"+b.id+"/details")}.bind(this),error:function(){this.sandbox.logger.log("error while saving profile")}.bind(this)})},load:function(a){this.sandbox.emit("sulu.router.navigate","content/contents/"+this.options.webspace+"/"+this.options.language+"/edit:"+a+"/details")},add:function(a){a?this.sandbox.emit("sulu.router.navigate","content/contents/"+this.options.webspace+"/"+this.options.language+"/add:"+a.id+"/details"):this.sandbox.emit("sulu.router.navigate","content/contents/"+this.options.webspace+"/"+this.options.language+"/add/details")},delContents:function(b){return b.length<1?void this.sandbox.emit("sulu.dialog.error.show","No contents selected for deletion!"):void this.confirmDeleteDialog(function(c){c&&b.forEach(function(b){var c=new a({id:b});c.fullDestroy(this.options.webspace,this.options.language,{success:function(){this.sandbox.emit("husky.datagrid.row.remove",b)}.bind(this),error:function(){}})}.bind(this))}.bind(this))},confirmDeleteDialog:function(a){if(a&&"function"!=typeof a)throw"callback is not a function";this.sandbox.emit("sulu.dialog.confirmation.show",{content:{title:"Be careful!",content:"<p>The operation you are about to do will delete data.<br/>This is not undoable!</p><p>Please think about it and accept or decline.</p>"},footer:{buttonCancelText:"Don't do it",buttonSubmitText:"Do it, I understand"},callback:{submit:function(){this.sandbox.emit("husky.dialog.hide"),a&&a(!0)}.bind(this),cancel:function(){this.sandbox.emit("husky.dialog.hide"),a&&a(!1)}.bind(this)}})},renderList:function(){var a=this.sandbox.dom.createElement('<div id="contacts-list-container"/>');this.html(a),this.sandbox.start([{name:"content/components/list@sulucontent",options:{el:a}}])},renderColumn:function(){var a=this.sandbox.dom.createElement('<div id="contacts-column-container"/>');this.html(a),this.sandbox.start([{name:"content/components/column@sulucontent",options:{el:a,webspace:this.options.webspace,language:this.options.language}}])},renderForm:function(){var b=this.sandbox.dom.createElement('<div id="contacts-form-container"/>');this.html(b),this.content=new a,this.options.id?(this.content=new a({id:this.options.id}),this.content.fullFetch(this.options.webspace,this.options.language,{success:function(a){this.sandbox.start([{name:"content/components/form@sulucontent",options:{el:b,id:this.options.id,data:a.toJSON(),webspace:this.options.webspace,language:this.options.language}}])}.bind(this),error:function(){this.sandbox.logger.log("error while fetching content")}.bind(this)})):this.sandbox.start([{name:"content/components/form@sulucontent",options:{el:b,data:this.content.toJSON(),webspace:this.options.webspace,language:this.options.language}}])}}});